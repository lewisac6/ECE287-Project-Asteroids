module meteorthing #(
    parameter SCREEN_W = 640,
    parameter SCREEN_H = 480
)
(
    input  wire        clk,
    input  wire        reset_n,
    input  wire        frame_tick,

    output reg [9:0]   meteor_x,
    output reg [9:0]   meteor_y,
    output reg [2:0]   meteor_size
);
    localparam [9:0] SPAWN_X0 = 80;
    localparam [9:0] SPAWN_X1 = 200;
    localparam [9:0] SPAWN_X2 = 320;
    localparam [9:0] SPAWN_X3 = 440;
    localparam [9:0] SPAWN_X4 = 560;
    reg [2:0] lane_sel = 0;
	 
function [9:0] spawn_x;
        input [2:0] lane;
        begin
            case (lane)
                3'd0: spawn_x = SPAWN_X0;
                3'd1: spawn_x = SPAWN_X1;
                3'd2: spawn_x = SPAWN_X2;
                3'd3: spawn_x = SPAWN_X3;
                3'd4: spawn_x = SPAWN_X4;
                default: spawn_x = SPAWN_X0;
            endcase
				end
				endfunction
				
   always @(posedge clk or negedge reset_n) begin
        if (!reset_n) begin
            lane_sel    <= 3'd0;
            meteor_x    <= SPAWN_X0;
            meteor_y    <= 10'd0;
            meteor_size <= 3'd2;
        end 
        else if (frame_tick) begin
            // Drop downward
            meteor_y <= meteor_y + 10;
				
            if (meteor_y > SCREEN_H) begin
                lane_sel    <= (lane_sel == 3'd4) ? 3'd0 : (lane_sel + 3'd1);
                meteor_x    <= spawn_x(lane_sel);
                meteor_y    <= 10'd0;
                meteor_size <= lane_sel; 
            end
        end
    end
endmodule